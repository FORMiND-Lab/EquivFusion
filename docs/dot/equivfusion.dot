digraph G {
  rankdir = TB
  splines=spline
  node [shape=box style=filled fillcolor="white" width=2]
  nodesep=0.2 // horizontal compression
  ranksep=0.5 // vertical compression
  compound=true

  // input fronttends
  subgraph cluster_inputs{
      label = "Inputs"
      node [shape=octagon fillcolor="#ffff99"]
      Pytorch
      C
      Chisel
      SV
  }


  subgraph cluster_tools {
    label = "External Tools"
    TorchMLIR [label="torch-mlir"]
    Slang
    Polygeist
    ScalaCompiler [label="Scala Compiler"]
  }


  FIRFile [label=".fir" fillcolor="#7fc97f" shape="note"]

  // equivfusion
  subgraph cluster_equivfusion {
      label = "EquivFusion"

      MLIR

      subgraph cluster_core_dialects {
          label = "Core dialects"
          node [fillcolor="#ffcc99"]
          Seq
          HW
          Comb
      }

      subgraph cluster_outputs {
          label = "Output Formats"
          node [fillcolor="#beaed4"]
          SMTLIB
          AIGER
          BTOR2
      }

      subgraph cluster_solvers {
          label = "Solvers"
          node [fillcolor="#7fc97f"]
          z3
          bitwuzla
          boolector
          kissat
      }

      MLIR -> HW        [lhead=cluster_core_dialects minlen=2]
      HW -> AIGER       [ltail=cluster_core_dialects lhead=cluster_outputs minlen=2]
      AIGER -> bitwuzla [ltail=cluster_outputs lhead=cluster_solvers minlen=2]
  }


  Pytorch -> TorchMLIR -> MLIR
  C -> Polygeist -> MLIR
  SV -> Slang -> MLIR
  Chisel -> ScalaCompiler -> FIRFile -> MLIR
}
